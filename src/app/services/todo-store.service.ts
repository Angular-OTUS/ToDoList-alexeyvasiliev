import { Todo, TodoDraft } from '@interfaces/Todo';
import { inject } from '@angular/core';
import { TodoToastService } from '@services/todo-toast.service';

export abstract class TodoStore {
  abstract getAll(): Todo[];

  abstract getById(id: number): Todo | undefined;

  abstract removeTodo(id: number): boolean;

  abstract addTodo(todoDraft: TodoDraft): void;

  abstract save(todo: Todo): void;
}

export class TodoStoreService extends TodoStore {
  #items: Todo[] = [...initialTodos];

  #toastService = inject(TodoToastService);

  getAll(): Todo[] {
    return this.#items;
  }

  removeTodo(id: number): boolean {
    const oldLength = this.#items.length;
    this.#items = this.#items.filter(todo => todo.id !== id);
    this.#toastService.showToast('üóëÔ∏è –ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞');

    return oldLength != this.#items.length;
  }

  addTodo(todoDraft: TodoDraft) {
    const id =
      this.#items.length === 0
        ? 1
        : this.#items.reduce((prev, current) => (prev.id > current.id ? prev : current)).id + 1;
    this.#toastService.showToast('‚úÖ –ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
    this.#items = [{ id, ...todoDraft }, ...this.#items];
  }

  getById = (id: number): Todo | undefined => this.#items.find(t => t.id === id);

  save(todo: Todo): void {
    this.#items = this.#items.map(t => (t.id !== todo.id ? t : todo));
    this.#toastService.showToast('‚úèÔ∏è –ó–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
  }
}

const initialTodos = [
  {
    id: 1,
    description: `‚òëÔ∏è –æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ Angular –ø—Ä–æ–µ–∫—Ç–∞
          ‚òëÔ∏è —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
          ‚òëÔ∏è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ç–∫–∏ –≤ —à–∞–±–ª–æ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞',`,
    text: '–ó–∞–≥–æ—Ç–æ–≤–∫–∞ Angular –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ToDo List',
  },
  {
    id: 2,
    description: `‚òëÔ∏è —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
      ‚òëÔ∏è —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–±—ã—Ç–∏–π —Å —à–∞–±–ª–æ–Ω–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
      ‚òëÔ∏è –≤–∫–ª—é—á–µ–Ω–∏–µ –æ–¥–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –¥—Ä—É–≥–∏–µ –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –Ω–∏–º–∏`,
    text: '–†–∞–±–æ—Ç–∞ —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏: –ø—Ä–∏–≤—è–∑–∫–∞ –ª–æ–≥–∏–∫–∏ –∫ —à–∞–±–ª–æ–Ω—É –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å—Ç–µ–π –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã',
  },
  {
    id: 3,
    description: `
 ‚òëÔ∏è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–º –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
 ‚òëÔ∏è —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–æ–¥—É–ª–∏
 ‚òëÔ∏è –¥–µ–∫–ª–∞—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –º–æ–¥—É–ª–µ
 ‚òëÔ∏è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω –º–æ–¥—É–ª—å –≤ –¥—Ä—É–≥–æ–π`,
    text: `–î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ (–∏–º–∏—Ç–∏—Ä—É–µ–º –ø–æ–¥–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö —Å –±–µ–∫—ç–Ω–¥–∞). –ò—Å–ø–æ–ª—å–∑—É–µ–º shared –º–æ–¥—É–ª—å`,
  },
  {
    id: 4,
    description: `
‚òëÔ∏è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–∏–≤–Ω—ã—Ö –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤
‚òëÔ∏è —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤`,
    text: '–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏, –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–ø–∏—Å–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞. –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏',
  },
  {
    id: 5,
    description: `
    ‚òëÔ∏è –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å –∫–æ—Ç–æ—Ä—ã–π –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞—à–µ–≥–æ todo list –ø—Ä–æ—Å—Ç–æ –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å/–∏–∑–º–µ–Ω—è—Ç—å –∏—Ö –ø–æ –∑–∞–ø—Ä–æ—Å—É.
    ‚òëÔ∏è –û–±–Ω–æ–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞, —á—Ç–æ–±—ã –ø–æ dblclick –≤–º–µ—Å—Ç–æ –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ title —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞ –ø–æ—è–≤–ª—è–ª—Å—è input —ç–ª–µ–º–µ–Ω—Ç –∏ –∫–Ω–æ–ø–∫–∞ save. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è title –∑–Ω–∞—á–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞.
    ‚òëÔ∏è –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å ToastService –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ToastsComponent. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –∏ –≤—ã–≤–æ–¥–∏—Ç –∏—Ö –≤ —É–≥–ª—É —ç–∫—Ä–∞–Ω–∞ –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º.
    –ù–∞—à –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á, —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä–≤–∏—Å ToastService –∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –∏–ª–∏ –µ—ë –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ showToast() —á—Ç–æ–±—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—è–≤–∏–ª–æ—Å—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ.

`,
    text: '–î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ä–≤–∏—Å—ã –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞',
  },
];
